---
layout: default
---

<header class="site-header">
  <div class="bar">
    <div class="brand">Biblioteca</div>
    <div class="search"><input id="q" type="search" placeholder="Buscar manga…"></div>
    <a class="chip" href="#">Descarga la app</a>
  </div>
</header>

<main class="container">
  <!-- Activos -->
  <div class="section-title"><span class="bar"></span><h2>Nuestros proyectos activos</h2></div>
  <div class="grid" id="grid-activos" aria-live="polite"></div>

  <!-- Joints -->
  <div class="section-title" style="margin-top:36px"><span class="bar"></span><h2>Joints</h2></div>
  <div class="grid" id="grid-joints" aria-live="polite"></div>

  <!-- Finalizados -->
  <div class="section-title" style="margin-top:36px"><span class="bar"></span><h2>Proyectos finalizados</h2></div>
  <div class="grid" id="grid-finalizados" aria-live="polite"></div>
</main>

<script>
(function(){
  // JSON movido a assets/data para que Jekyll siempre lo copie al _site
  const CATALOG_URL = "{{ '/assets/data/catalogo.json' | relative_url }}?v={{ site.github.build_revision }}";
  // BASE ya incluye el baseurl correcto, por ejemplo "/pruebaPAG.github.io/"
  const BASE = "{{ '/' | relative_url }}";

  const $ = sel => document.querySelector(sel);
  const grids = {
    activos: $('#grid-activos'),
    joints: $('#grid-joints'),
    finalizados: $('#grid-finalizados')
  };

  const ensureArray = v => Array.isArray(v) ? v : [];

  function withBase(url){
    // quita "/" inicial y antepone BASE
    return BASE + String(url || '#').replace(/^\//,'');
  }
  function imgWithBase(src){
    // si ya es absoluta (http/https), se deja; si es relativa, se prefija con BASE
    if(!src) return 'https://via.placeholder.com/480x640?text=Cover';
    return /^(https?:)?\/\//i.test(src) ? src : withBase(src);
  }

  function cardHTML(item){
    if(!item) return '';
    const title  = item.title || 'Sin título';
    const href   = withBase(item.url || '#');          // baseurl aplicado
    const cover  = imgWithBase(item.cover);            // baseurl aplicado
    const tags   = ensureArray(item.tags);
    const latest = item.latest || '';
    const chips  = tags.map(t => `<span class="chip">${t}</span>`).join('');
    return `
      <a class="card" href="${href}">
        <div class="card-cover"><img src="${cover}" alt="${title}" loading="lazy"></div>
        <div class="card-body">
          <h3 class="card-title">${title}</h3>
          <div class="chips">${chips}</div>
          <div class="meta">${latest}</div>
        </div>
      </a>`;
  }

  function render(list, el){
    if (!Array.isArray(list)) {
      el.innerHTML = `<div class="meta">No hay elementos.</div>`;
      return;
    }
    el.innerHTML = list.map(cardHTML).join('') || `<div class="meta">No hay elementos.</div>`;
  }

  async function load(){
    Object.values(grids).forEach(g => g.innerHTML = `<div class="meta">Cargando…</div>`);
    try{
      const res = await fetch(CATALOG_URL, {cache:'no-store'});
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      // Distribución manual: 1 activo, 1 joint, 1 finalizado
      const activos = [data[0]];       // Ririsa
      const joints  = [data[1]];       // Las 100 Novias
      const finalizados = [data[2]];   // Saneka

      render(activos, grids.activos);
      render(joints, grids.joints);
      render(finalizados, grids.finalizados);
    }catch(e){
      console.error('No se pudo cargar catalogo.json:', e);
      Object.values(grids).forEach(g => g.innerHTML = `<div class="meta">Error cargando catálogo.</div>`);
    }
  }

  // búsqueda (simple: título o tags)
  document.getElementById('q')?.addEventListener('input', (e)=>{
    const q = e.target.value.trim().toLowerCase();
    // filtro en el DOM (simple) para no re-pedir el JSON
    document.querySelectorAll('.card').forEach(a=>{
      const text = a.textContent.toLowerCase();
      a.style.display = text.includes(q) ? '' : 'none';
    });
  });

  load();
})();
</script>
