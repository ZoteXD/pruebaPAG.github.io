---
layout: default
title: Lector
use_main_css: false
---

<header class="topbar">
  <div class="title">
    {{ page.manga | default: page.title | default: "Manga" }} - Capítulo {{ page.capitulo | default: "?" }}
  </div>
  <div class="spacer"></div>
  <div class="toolbar">
    <div id="pager" class="pager">Pag 0 / 0</div>
  </div>
</header>

<div id="reader"></div>

<div class="nav-buttons">
  {% if page.capitulo and page.capitulo > 1 %}
    <a class="btn" href="{{ site.baseurl }}/{{ page.manga_slug | default: '' }}/cap{{ page.capitulo | minus:1 }}/">← Anterior</a>
  {% else %}
    <span></span>
  {% endif %}

  {% if page.es_ultimo != true %}
    <a class="btn" href="{{ site.baseurl }}/{{ page.manga_slug }}/cap{{ page.capitulo | plus:1 }}/">Siguiente →</a>
  {% endif %}
</div>

<a class="back" href="{{ site.baseurl }}{{ page.return_to | default: '/' }}">← Regresar al post</a>

<script type="module">
async function load() {
  const container = document.getElementById("reader");
  const pager = document.getElementById("pager");

  const jsonUrl = "{{ page.images_json }}";
  if (!jsonUrl) {
    container.innerHTML = '<p class="error">Falta el campo images_json en este capítulo.</p>';
    return;
  }

  try {
    const res = await fetch(jsonUrl);
    if (!res.ok) throw new Error(res.status);
    const images = await res.json();

    pager.textContent = `Pag 1 / ${images.length}`;

    images.forEach((src, i) => {
      const fig = document.createElement("figure");
      fig.className = "page";

      const img = document.createElement("img");
      img.src = src;
      img.alt = `Capítulo - ${i + 1}`;
      img.onload = () => {
        pager.textContent = `Pag ${i + 1} / ${images.length}`;
      };

      fig.appendChild(img);
      container.appendChild(fig);
    });

  } catch (e) {
    container.innerHTML = `<p class="error">Error al cargar JSON: ${e}</p>`;
  }
}

load();
</script>
